<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <title>Stock Scan</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logoMark" aria-hidden="true"></div>
      <div class="brandTxt">
        <div class="title">Stock Scan</div>
        <div class="subtitle">NEW stocktake • Bluetooth scanner ready</div>
      </div>
    </div>
    <button id="btnHelp" class="iconBtn" aria-label="Help">?</button>
  </header>

  <main class="shell">
    <section class="card hero">
      <div class="heroLeft">
        <div class="statusPill" id="statusPill">
          <span class="dot"></span>
          <span id="statusText">Ready to scan</span>
        </div>

        <div class="scanLine">
          <div class="scanLabel">Last scan</div>
          <div class="scanValue mono" id="lastScan">—</div>
          <div class="scanHint" id="scanHint">Scan a barcode now. No Enter needed.</div>
        </div>

        <div class="row">
          <div class="field">
            <label>Make</label>
            <select id="makeSel"></select>
          </div>
          <div class="field">
            <label>Condition</label>
            <input value="NEW (locked)" disabled />
          </div>
        </div>

        <div class="row actions">
          <label class="btn primary">
            <input id="csvFile" type="file" accept=".csv,text/csv" hidden>
            Load CSV
          </label>
          <button id="btnExport" class="btn" disabled>Export scanned CSV</button>
          <button id="btnReset" class="btn danger" disabled>Reset</button>
        </div>

        <div class="tiny" id="datasetInfo">No dataset loaded yet.</div>
      </div>

      <div class="heroRight">
        <div class="ringWrap">
          <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
            <circle class="track" cx="60" cy="60" r="46"></circle>
            <circle class="progress" cx="60" cy="60" r="46"></circle>
          </svg>
          <div class="ringCenter">
            <div class="big" id="pct">0%</div>
            <div class="small">complete</div>
          </div>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">Expected</div>
            <div class="v mono" id="expected">0</div>
          </div>
          <div class="stat">
            <div class="k">Scanned</div>
            <div class="v mono good" id="scanned">0</div>
          </div>
          <div class="stat">
            <div class="k">Remaining</div>
            <div class="v mono" id="remaining">0</div>
          </div>
        </div>
      </div>
    </section>

    <section class="card list">
      <div class="listHead">
        <div>
          <div class="h2">Scanned items</div>
          <div class="tiny">Duplicates are blocked automatically.</div>
        </div>
        <div class="chip mono" id="chipCount">0</div>
      </div>
      <div class="listBody" id="scannedList">
        <div class="empty" id="emptyList">No scans yet.</div>
      </div>
    </section>
  </main>

  <dialog id="dlgHelp" class="dlg">
    <div class="dlgCard">
      <div class="dlgTitle">How scanning works</div>
      <div class="dlgText">
        <p>This app listens for fast keyboard bursts from a Bluetooth barcode scanner (HID keyboard mode).</p>
        <ul>
          <li>No camera access.</li>
          <li>No Enter key required.</li>
          <li>Only rows where <b>Condition</b> is <b>NEW</b> are counted.</li>
          <li><b>Stock #</b> is treated as the barcode and must be unique.</li>
        </ul>
        <p class="tiny">Tip: If your scanner appends Enter, that's fine — it will still work.</p>
      </div>
      <div class="dlgActions">
        <button class="btn primary" id="btnCloseHelp">OK</button>
      </div>
    </div>
  </dialog>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script src="app.js" defer></script>
</body>
</html>
